# ETL (Extraction, Transformation and Load)

데이터의 이동 및 변환 절차와 관련된 업계 표준 용어로, 데이터를 적재하는 작업의 핵심 구성요소이다.   
데이터 통합, 데이터 이동, 마스터 데이터 관리에 걸쳐 폭넓게 활용되며 이동 및 변환을 주목적으로 한다.   
여러 상용 소프트웨어들이 있으며, Batch ETL, Real Time ETL로 구분된다.

## ETL의 기능

- Extraction(추출) : 하나 또는 그 이상의 데이터 원천들로부터 데이터 획득
- Transformation(변형) : 데이터 클렌징·형식 변환·표준화, 통합 또는 다수 애플리케이션에 내장된 비즈니스 룰 적용 등
- Load(적재) : 변형 단계의 처리가 완료된 데이터를 특정 목표 시스템에 적재

## ETL의 작업 단계

|Step|     작업명      |내용                                                                                                            |
|:--:|:---------------:|:---------------------------------------------------------------------------------------------------------------|
| 0  |    Interface    |다양한 이기종 DBMS 및 스프레드시트 등 데이터 원천으로부터 데이터를 획득하기 위한 인터페이스 메커니즘 구현       |
| 1  |   Staging ETL   |수립된 일정에 따라 데이터 원천으로부터 트랜잭션 데이터 획득 작업 수행 후, 획득된 데이터를 스테이징 테이블에 저장|
| 2  |  Profiling ETL  |스테이징 테이블에서 데이터 특성을 식별하고 품질을 측정                                                          |
| 3  |  Cleansing ETL  |다양한 규칙들을 활용해 프로파일링된 데이터의 보정 작업을 수행                                                   |
| 4  | Integration ETL |(이름, 값, 구조) 데이터 충돌을 해소하고, 클렌징된 데이터를 통합                                                 |
| 5  |Denormalizing ETL|운영 보고서 생성 및 데이터 웨어하우스 또는 데이터 마트에 대한 데이터 적재를 위해 데이터 비정규화 수행           |

# ODS (Operational Data Store)

데이터에 대한 추가 작업을 위해 다양한 데이터 원천들로부터 데이터를 추출·통합한 데이터베이스다.   
일반적으로 **실시간** 또는 **실시간 근접 트랜잭션 데이터** 혹은 가격 등의 원자성을 지닌 하위 수준 데이터들을 저장하기 위해 설계된다.

ODS 내 데이터는 향후 비즈니스 지원 및 다양한 보고서 생성을 위해 타 정보 시스템이나 데이터 웨어하우스로 이관된다.
다양한 원천들로부터 데이터 구성되는만큼, ODS를 위한 데이터 통합은 데이터 클렌징, 중복제거, 비즈니스 룰 대비 데이터 무결성 점검 등의 작업들을 포함한다.

## ODS 구성 단계

|Step|     단계명      |
|:--:|:---------------:|
| 1  | Interface Layer |
| 2  |  Staging Layer  |
| 3  | Profiling Layer |
| 4  | Cleansing Layer |
| 5  |Integration Layer|
| 6  |  Export Layer   |

### 인터페이스 단계 (Interface)

- 다양한 데이터 원천으로부터 데이터를 획득하는 단계
- 데이터 획득 시 사용하는 프로토콜 : OLEDB(Object Linking and Embedding Database), ODBC(Object Data Base Connectivity), FTP(File Transfer Protocol) 등
- 데이터 웨어하우스에 대한 실시간 or 근접 실시간 OLAP 질의를 지원하기 위한 실시간 데이터 복제 인터페이스 기술들이 함께 활용된다.
    - OLAP (Online Analytical Processing) : 데이터 웨어하우스 상의 데이터에 대해 다양한 방식으로 다차원 분석을 진행하는 것을 의미

### 데이터 스테이징 단계 (Staging)

- 데이터 원천들로부터 트랜잭션 데이터들이 추출되어 하나 또는 그 이상의 스테이징 테이블들에 저장되는 단계
- 스테이징 테이블들은 정규화가 배제되며, 스키마는 데이터 원천의 구조에 의존적이다.
- 데이터 원천과 스테이징 테이블의 데이터 매핑은 **일대일 또는 일대다**로 구성될 수 있다.
- 스테이징 테이블에 적재되는 시점에 여러 통제 정보들이 추가된다.
- 이기종 데이터 원천으로부터 데이터 획득 후 스테이징 테이블에 적재하며, 이 때 일괄 작업 형태인 정기적인 ETL과 실시간 ETL을 혼용할 수 있다.

### 데이터 프로파일링 단계 (Profiling)

- **데이터 품질 점검**을 하는 단계
- 절차 : 스테이징 테이블의 데이터에 대한 프로파일링 수행 → 프로파일링 결과 통계 처리 → 데이터 품질 보고서 생성 및 공유

### 데이터 클렌징 단계 (Cleansing)

- 프로파일링 단계에서 식별된 **오류 데이터들을 수정**하는 단계
- 절차 : 클렌징 스토어드 프로시저 실행(예비작업) → 클렌징 ETL 도구 실행

### 데이터 인터그레이션 단계 (Integration)

- 수정 완료한 데이터를 ODS 내의 **단일 통합 테이블에 적재**하는 단계
- 절차 : 통합 스토어드 프로시저 실행(예비작업) → 통합 ETL 도구 실행

### 익스포트 단계 (Export)

- 통합된 데이터에 대해 익스포트 규칙과 보안 규칙을 반영한 익스포트 ETL 기능을 수행해 익스포트 테이블을 생성
    → 다양한 DBMS 클라이언트 또는 데이터 마트, 데이터 웨어하우스에 익스포트 테이블을 적재하는 단계
- OLAP 비정형 질의에 활용될 수 있다.

# 데이터 웨어하우스 (Data Warehouse)

ODS를 통해 정제 및 통합된 데이터가 데이터 분석과 보고서 생성을 위해 적재되는 데이터 저장소

## 특징

### 주제 중심성 (Subject Oriented)

데이터 웨어하우스의 데이터는 실 업무 상황의 특정 이벤트나 업무 항목을 기준으로 구조화되므로, 최종 사용자도 이해하기 쉬운 형태를 지닌다.

### 영속성·비휘발성 (Non Volatile)

데이터 웨어하우스의 데이터는 최초 저장 이후에는 **읽기 전용(Read Only)의 속성**을 가지며, **삭제되지 않는다**.

### 통합성 (Integrated)

데이터 웨어하우스의 데이터는 기관·조직이 보유한 대부분의 운영 시스템들에 의해 생성된 데이터들의 통합본이다.

### 시계열성 (Time Variant)

운영 시스템들은 최신 데이터를 보유하고 있지만, 데이터 웨어하우스는 시간 순에 의한 이력 데이터를 보유한다.

## 테이블 모델링 기법

### 스타 스키마

- 조인 스키마(Join Schema)라고도 하며, 가장 단순한 형태이다.
- 단일 사실 테이블(Fact Table)을 중심으로 다수의 차원 테이블(Dimensional Table)들로 구성된다.
    - 사실 테이블은 보통 **제 3정규형**으로 모델링하고, 차원 테이블들은 보통 비정규화된 **제 2정규형**으로 모델링한다.
- 전통적 RDB를 통해 다차원 데이터베이스(Multi-Dimensional DataBase) 기능을 구현할 수 있다.

#### 장점

- 복잡도가 낮아서 이해하기 쉽다.
- 쿼리 작성이 용이하다.
- 조인 테이블 개수가 적다.

#### 단점

- 차원 테이블들의 비정규화에 따른 데이터 중복이 발생한다. → 데이터 적재 시 상대적으로 많은 시간이 소요된다.

### 스노우 플레이크 스키마

- 스타 스키마의 차원 테이블을 **제 3정규형**으로 정규화한 형태이다.

#### 장점

- 데이터 중복이 제거되어, 데이터 적재 시 시간이 빠르다.

#### 단점

- 스키마 구조의 복잡성이 증가하여 조인 테이블의 개수가 증가하고, 쿼리 작성의 난이도가 상승한다.

# ODS와 DW 비교

|    구분     |                       ODS                        |              DW               |
|:-----------:|:------------------------------------------------:|:--+--------------------------:|
|데이터의 내용|           현재 또는 비교적 최신 데이터           |     다양한 구조의 데이터      |
| 데이터의 양 |                      소규모                      |            대규모             |
|데이터의 갱신|Volatile : 지속적으로 갱신되어 현재 DB 상태를 반영|Non-Volatile : 데이터 축적 보관|
| 기술적 요소 |      DB 처리의 모든 기능을 사용하도록 설계       |적재(Load)와 접근(Access) 중심 |

# 데이터베이스 정규화

데이터 중복을 줄이고, 이상현상을 방지하기 위해 구조화하는 과정

## 제 1정규형

모든 속성(컬럼, Attribute, Column)은 원자값(더 이상 나눠지지 않는 값)만 가져야 한다.

### 예시

| 학번 | 이름 | 전화번호                       |
|:----:|:----:|:------------------------------:|
| 1001 |홍길동|010-1111-2222, 010-3333-4444 ❌|

- 하나의 열에 여러 전화번호가 입력됨

| 학번 | 이름 | 전화번호          |
|:----:|:----:|:-----------------:|
| 1001 |홍길동| 010-1111-2222     |
| 1001 |홍길동| 010-3333-4444 ✅ |

- 전화번호를 원자값으로 분리

## 제 2정규형

제 1정규형을 만족하면서, 기본 키(Primary Key)의 부분 종속성(Partial Dependency)을 제거하여, 복합키(Composite Key)의 일부에만 종속되는 속성이 없어야 한다.

### 예시

|학생ID|과목ID|성적| 과목명       |
|:----:|:----:|:--:|:------------:|
| S1   | C1   | A  | 데이터베이스 |
| S1   | C2   | B  | 운영체제     |
| S2   | C1   | A+ | 데이터베이스 |

- 성적은 (학생ID, 과목ID) 전체 키에 종속됨 ✅
- 과목명은 과목ID에만 종속됨 → 부분 종속 ❌

#### 성적 테이블
|학생ID|과목ID|성적|
|:----:|:----:|:--:|
| S1   | C1   | A  |
| S1   | C2   | B  |
| S2   | C1   | A+ |

#### 과목 테이블
|과목ID| 과목명       |
|:----:|:------------:|
| C1   | 데이터베이스 |
| C2   | 운영체제     |

- 테이블을 분리함으로써 부분 종속성을 제거한다.

## 제 3정규형

제 2정규형을 만족하면서, 이행적 종속성(Transitive Dependency) 제거하여, 기본 키가 아닌 속성이 다른 속성에 종속되면 안 된다.

### 예시

| 학번 |  이름  |학과ID| 학과명     |
|:----:|:------:|:----:|:----------:|
| 1001 | 홍길동 | D1   | 컴퓨터공학 |
| 1002 | 이영희 | D2   | 경영학     |
| 1003 | 김철수 | D1   | 컴퓨터공학 |

- 학과명은 학번이 아니라 학과ID에 종속됨 → 이행 종속 ❌

#### 학생 테이블
| 학번 |  이름  |학과ID|
|:----:|:------:|:----:|
| 1001 | 홍길동 | D1   |
| 1002 | 이영희 | D2   |
| 1003 | 김철수 | D1   |

#### 학과 테이블
|학과ID| 학과명     |
|:----:|:----------:|
| D1   | 컴퓨터공학 |
| D2   | 경영학     |

- 테이블을 분리함으로써 이행 종속성을 제거한다.